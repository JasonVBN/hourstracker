<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="/static/index.css">
    <link rel="stylesheet" href="/static/navbar.css">
    <link rel="stylesheet" href="/static/slideswitch.css">
</head>
<body>
    <div class="container">
        <img src="/static/monkey1.png" alt="Monkey" style="display:block; max-height: 80px;">
        <p>Name: {{ session['userinfo'].get('fname') + ' ' + session['userinfo'].get('lname') }}</p>
        <p>Role: {{ session['userinfo'].get('role') }} <a href="/admin/request">[Change]</a></p>
        <p>Email: {{ session['userinfo'].get('email') }}</p>
        
        <label class="switch" id="notif-switch">
            <input type="checkbox" id="email-notify-toggle">
            <span class="slider"></span>
        </label>
        <span style="margin-left:12px;vertical-align:middle;">Email notifications</span>
        
        <p>Bio: <a href="#" id="edit-bio-link">[Edit]</a></p>
        <p id="bio-text">
            {{ session['userinfo']['bio']|replace('\n', '<br>')|safe }}</p>
        <form id="bio-form" action="/profile/editbio" method="post" style="display:none;">
            <textarea name="bio" id="bio" rows="4" placeholder="Add your bio here">{{ session['userinfo'].get('bio') }}</textarea>
            <br>
            <button type="submit">Save</button>
        </form>
    </div>
    <script>
    document.getElementById('edit-bio-link').onclick = function(e) {
        e.preventDefault();
        document.getElementById('bio-text').style.display = 'none';
        document.getElementById('bio-form').style.display = 'block';
        this.style.display = 'none';
    };

    document.getElementById('email-notify-toggle').checked = {{ 'true' if session['userinfo'].get('notifs') else 'false' }};
    document.getElementById('email-notify-toggle').onchange = function() {
        const isChecked = this.checked;
        fetch('/profile/editnotif', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ notify: isChecked })
        }).then(response => {
            if (!response.ok) {
                console.error('Failed to update notification preference');
            }
        }).catch(error => {
            console.error('Error:', error);
        }).then(
            () => {
                window.location.href = '/profile'; // Refresh the page to reflect changes
            }
        );
    };
    </script>

    <!-- NAV BAR -->
    <div id="navbar" class="navbar">
        <button id="nav-toggle" class="nav-toggle">â˜°</button>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li class="current"><a href="/profile">Profile</a></li>
            <li><a href="/logout">Logout</a></li>
        </ul>
        {% if session.get('userinfo')['role']=='admin' 
        and session.get('userinfo')['status']=='approved' %}
        <ul class="nav-links">
            <h2 class="nav-header">ADMIN ZONE:</h2>
            <li><a href="/events">Events</a></li>
            <li><a href="/entries/pending">Pending Entries</a></li>
            <li><a href="/roster">Roster</a></li>
            <li><a href="/export">Export Data</a></li>
            <li><a href="/auditlog">Audit Log</a></li>
        </ul>
        {% endif %}
    </div>
    <script>
    document.getElementById('nav-toggle').onclick = function() {
        var navbar = document.getElementById('navbar');
        navbar.classList.toggle('collapsed');
        // Save state
        localStorage.setItem('navbarCollapsed', navbar.classList.contains('collapsed') ? '1' : '0');
    };
    window.addEventListener('DOMContentLoaded', function() {
        var navbar = document.getElementById('navbar');
        if (localStorage.getItem('navbarCollapsed') === '1') {
            navbar.classList.add('collapsed');
        } else {
            navbar.classList.remove('collapsed');
        }
    });
    </script>
    <!-- END OF NAV BAR -->
</body>
</html>